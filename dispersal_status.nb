(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    135511,       3733]
NotebookOptionsPosition[    131158,       3594]
NotebookOutlinePosition[    131514,       3610]
CellTagsIndexPosition[    131471,       3607]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Parental effects and information about immigration status", "Title",
 CellChangeTimes->{{3.682963715251602*^9, 3.6829637479299793`*^9}, {
  3.683011151779606*^9, 3.683011170635013*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.683011145504734*^9, 3.683011149892263*^9}}],

Cell[CellGroupData[{

Cell["Patch frequencies", "Section",
 CellChangeTimes->{{3.682963783537328*^9, 3.682963785456912*^9}}],

Cell["\<\
1 individual per patch. 
Each patch can be in one of two environmental states. 
Individuals can be adapted or maladapted to their local environment. 
Individuals can either have dispersed 'd' or are native 'n' to a local patch \
(I use 'd' to prevent the use of 'i' for immigrant).
Hence we have f[1,a,d], f[1,a,n], f[1,m,d], f[1,m,n], etc.., hence in total 8 \
different patch types.\
\>", "Text",
 CellChangeTimes->{{3.682963789192925*^9, 3.6829638437740993`*^9}, {
  3.68296396881841*^9, 3.682963969096774*^9}, {3.6830104312596197`*^9, 
  3.683010516944092*^9}, {3.6830108414894733`*^9, 3.6830108473047323`*^9}, {
  3.683011878362398*^9, 3.683011923751816*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"patches", "=", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "state", ",", "immstate"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"ei", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"state", ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"immstate", ",", 
       RowBox[{"{", 
        RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}], "//", 
   "Flatten"}]}]], "Input",
 CellChangeTimes->{{3.683011210624525*^9, 3.683011250094902*^9}, {
   3.683012859895232*^9, 3.683012873819942*^9}, {3.683012918844051*^9, 
   3.6830129199314737`*^9}, 3.683116825699095*^9, 3.68311686516593*^9, {
   3.683116925844294*^9, 3.683116932821107*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "imm"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "phil"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "imm"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "phil"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "imm"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "phil"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "m", ",", "imm"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "m", ",", "phil"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.683011236290183*^9, 3.683011250734795*^9}, 
   3.6830127915018797`*^9, 3.683012921758181*^9, {3.683013184110072*^9, 
   3.683013209018675*^9}, 3.68301388947456*^9, 3.683014050354312*^9, 
   3.683014337327977*^9, 3.683014493210595*^9, 3.683016284109654*^9, 
   3.683016413202855*^9, 3.683016558151888*^9, 3.6830167476219883`*^9, 
   3.6830168540407953`*^9, 3.6830169057846622`*^9, 3.683017338995345*^9, 
   3.683017444940094*^9, 3.6830191370790243`*^9, 3.683019463579926*^9, 
   3.68301950501723*^9, 3.6830202890572977`*^9, 3.683020345261963*^9, 
   3.68302039494326*^9, 3.683020640791716*^9, 3.683021924542351*^9, 
   3.683021986393055*^9, {3.683022201416576*^9, 3.68302228032495*^9}, 
   3.683026283945006*^9, 3.683027233450605*^9, 3.683027305385638*^9, 
   3.683027627689308*^9, 3.683027670652339*^9, 3.683028536717312*^9, 
   3.683028745740011*^9, 3.683029380877013*^9, 3.683030320225197*^9, 
   3.683030767593566*^9, 3.683030799964608*^9, 3.6831147871904993`*^9, 
   3.683116788030608*^9, 3.6831169865822763`*^9, 3.683117159599084*^9, 
   3.683117605319409*^9, 3.6831179082981167`*^9, 3.68312021260472*^9, 
   3.683120414265438*^9, 3.683135745322516*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"patchesTest", "=", 
  RowBox[{
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ei", ",", "state", ",", "immstate"}], "]"}], "\[Rule]", 
      RowBox[{
       FractionBox["1", "2"], 
       RowBox[{"f", "[", 
        RowBox[{"ei", ",", "state"}], "]"}]}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ei", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"state", ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"immstate", ",", 
       RowBox[{"{", 
        RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}], "//", 
   "Flatten"}]}]], "Input",
 CellChangeTimes->{{3.683015829601486*^9, 3.68301583594479*^9}, {
   3.683019245366971*^9, 3.683019249164928*^9}, 3.683116825747154*^9, 
   3.6831168652030163`*^9, {3.683116939318595*^9, 3.683116941861536*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"1", ",", "a"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"1", ",", "a"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"1", ",", "m"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"1", ",", "m"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"2", ",", "a"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"2", ",", "a"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"2", ",", "m"}], "]"}]}]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    RowBox[{
     FractionBox["1", "2"], " ", 
     RowBox[{"f", "[", 
      RowBox[{"2", ",", "m"}], "]"}]}]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6830158397517033`*^9, 3.683016284191161*^9, 3.6830164132084713`*^9, 
   3.683016558157544*^9, 3.683016747701339*^9, 3.683016854093504*^9, 
   3.683016905790316*^9, 3.6830173390010443`*^9, 3.683017444946186*^9, 
   3.683019137084874*^9, 3.683019249763425*^9, 3.683019463587635*^9, 
   3.683019505109355*^9, 3.6830202891120157`*^9, 3.683020345268857*^9, 
   3.683020395009202*^9, 3.68302064079788*^9, 3.683021924609692*^9, 
   3.68302198647521*^9, {3.683022201526174*^9, 3.68302228035923*^9}, 
   3.683026284010537*^9, 3.6830272334564533`*^9, 3.683027305456218*^9, 
   3.683027627758828*^9, 3.68302767065799*^9, 3.683028536722911*^9, 
   3.683028745817997*^9, 3.683029380972842*^9, 3.6830303202356863`*^9, 
   3.683030767685117*^9, 3.6830308000378313`*^9, 3.6831147872358723`*^9, 
   3.6831167880711727`*^9, 3.6831169865897017`*^9, 3.6831171597334642`*^9, 
   3.683117605358436*^9, 3.68311790830682*^9, 3.683120212653791*^9, 
   3.6831204143154507`*^9, 3.68313574536235*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"patchinitvalsT", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"fx", "->", 
     RowBox[{"1", "/", 
      RowBox[{"Length", "[", "patches", "]"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"fx", ",", "patches"}], "}"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.683016747778986*^9, 3.683016854137492*^9, 3.6830169057959633`*^9, 
   3.683017339006735*^9, 3.683017444951955*^9, 3.683019137091176*^9, 
   3.6830194635952263`*^9, 3.683019505115847*^9, 3.683020289162344*^9, 
   3.683020345275002*^9, 3.683020395074511*^9, 3.683020640803142*^9, 
   3.683021924676468*^9, 3.683021986556183*^9, {3.6830222017174683`*^9, 
   3.683022280399865*^9}, 3.6830262840770903`*^9, 3.683027233462529*^9, 
   3.683027305523263*^9, 3.683027627826915*^9, 3.683027670663714*^9, 
   3.6830285367287817`*^9, 3.683028745895152*^9, 3.683029380983123*^9, 
   3.683030320246214*^9, 3.6830307676975813`*^9, 3.6830308000996323`*^9, 
   3.683114787282312*^9, 3.683116788104147*^9, 3.683116986598959*^9, 
   3.6831171597983093`*^9, 3.683117605396975*^9, 3.683117908313719*^9, 
   3.683120212702457*^9, 3.683120414361433*^9, 3.683135745399157*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Basic functions", "Subsection",
 CellChangeTimes->{{3.683010540975642*^9, 3.683010543062984*^9}}],

Cell["\<\
Determine whether individual has a z1 or z2 phenotype dependent on its \
current environment and its adaptedness\
\>", "Text",
 CellChangeTimes->{{3.683010729779316*^9, 3.683010756618363*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"phen", "[", 
    RowBox[{"ei_", ",", "state_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"{", "state", "}"}], ",", "a"}], "]"}], ">", "0"}], "&&", 
       RowBox[{"ei", "\[Equal]", "1"}]}], "||", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{"{", "state", "}"}], ",", "m"}], "]"}], ">", "0"}], "&&", 
       RowBox[{"ei", "\[Equal]", "2"}]}]}], ",", "1", ",", "2"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.683010688684578*^9, 3.683010721285626*^9}}],

Cell["\<\
Probability that an adapted immigrant fills a vacant breeding spot on a \
environment ei patch, currently having a breeder in state 'state' with \
immigrant status 'imm':\
\>", "Text",
 CellChangeTimes->{{3.683010544999722*^9, 3.683010604558526*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pad", "[", 
   RowBox[{"ei_", ",", "state_", ",", "immstate_"}], "]"}], ":=", 
  RowBox[{"d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"p", "[", 
         RowBox[{
          RowBox[{"phen", "[", 
           RowBox[{"ex", ",", "statex"}], "]"}], ",", "immx"}], "]"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{
           RowBox[{"phen", "[", 
            RowBox[{"ex", ",", "statex"}], "]"}], ",", "immx"}], "]"}]}]}], 
       "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"immx", ",", 
       RowBox[{"{", 
        RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.682965287715393*^9, 3.6829653129769163`*^9}, {
   3.683010609819212*^9, 3.683010674806024*^9}, {3.6830107693729963`*^9, 
   3.6830108078388968`*^9}, {3.683010851398086*^9, 3.683010855876898*^9}, {
   3.683010922525457*^9, 3.6830109226836367`*^9}, 3.683012932801115*^9, 
   3.683116825816865*^9, 3.683116865258686*^9, {3.6831169532720213`*^9, 
   3.683116953679295*^9}}],

Cell["\<\
Probability that an adapted philopatric individual fills a vacant breeding \
spot on a environment ei patch, currently having a breeder in state 'state' \
with immigrant status 'imm':\
\>", "Text",
 CellChangeTimes->{{3.683010833266453*^9, 3.6830108389606256`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pan", "[", 
   RowBox[{"ei_", ",", "state_", ",", "immstate_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "state"}], "]"}], ",", "immstate"}], "]"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "state"}], "]"}], ",", "immstate"}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6830108160197973`*^9, 3.683010823540797*^9}, {
  3.6830108958123283`*^9, 3.6830109503509912`*^9}, {3.683010999336651*^9, 
  3.683010999461753*^9}, {3.6831169604148903`*^9, 3.6831169680605907`*^9}}],

Cell["\<\
For testing purposes let's build the functions yielding maladapted immigrant \
and philpatric individuals\
\>", "Text",
 CellChangeTimes->{{3.6830109723414097`*^9, 3.683010997092924*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pmd", "[", 
   RowBox[{"ei_", ",", "state_", ",", "immstate_"}], "]"}], ":=", 
  RowBox[{"d", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{"1", "-", 
         RowBox[{"p", "[", 
          RowBox[{
           RowBox[{"phen", "[", 
            RowBox[{"ex", ",", "statex"}], "]"}], ",", "immx"}], "]"}]}], ",", 
        RowBox[{"p", "[", 
         RowBox[{
          RowBox[{"phen", "[", 
           RowBox[{"ex", ",", "statex"}], "]"}], ",", "immx"}], "]"}]}], 
       "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"statex", ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"immx", ",", 
       RowBox[{"{", 
        RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pmn", "[", 
   RowBox[{"ei_", ",", "state_", ",", "immstate_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"1", "-", "d"}], ")"}], 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ei", "\[Equal]", "1"}], ",", 
     RowBox[{"1", "-", 
      RowBox[{"p", "[", 
       RowBox[{
        RowBox[{"phen", "[", 
         RowBox[{"ei", ",", "state"}], "]"}], ",", "immstate"}], "]"}]}], ",", 
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"phen", "[", 
        RowBox[{"ei", ",", "state"}], "]"}], ",", "immstate"}], "]"}]}], 
    "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.683011002065735*^9, 3.683011026628399*^9}, 
   3.68301293594909*^9, 3.6831168258428307`*^9, 3.683116865281345*^9, {
   3.6831169704211187`*^9, 3.683116976979919*^9}}],

Cell["All probabilities should sum to 1 for a given patch type", "Text",
 CellChangeTimes->{{3.683011081419016*^9, 3.683011101506484*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pad", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "+", 
    RowBox[{"pan", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "+", 
    RowBox[{"pmd", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "+", 
    RowBox[{"pmn", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}]}], "/.", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    RowBox[{"1", "-", 
     RowBox[{"Total", "[", 
      RowBox[{"patches", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", 
         RowBox[{
          RowBox[{"Length", "[", "patches", "]"}], "-", "1"}]}], "]"}], "]"}],
       "]"}]}]}]}], "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.683011032658225*^9, 3.683011057778932*^9}, 
   3.68301111932535*^9, {3.683011182778324*^9, 3.6830112071518583`*^9}, {
   3.6830112911848707`*^9, 3.683011331599565*^9}, {3.6830129474541893`*^9, 
   3.683012974348171*^9}, {3.6830143903323727`*^9, 3.683014390948366*^9}, {
   3.683116825864066*^9, 3.683116825895832*^9}, 3.6831168653008013`*^9}],

Cell[BoxData["1"], "Output",
 CellChangeTimes->{{3.683011052917289*^9, 3.683011058885253*^9}, 
   3.683011119708787*^9, {3.683011173944549*^9, 3.683011184913939*^9}, {
   3.683011291689066*^9, 3.683011332508306*^9}, 3.683012791614964*^9, {
   3.6830131842276163`*^9, 3.683013209129468*^9}, 3.683013889578765*^9, 
   3.68301405048042*^9, 3.6830143374045267`*^9, 3.683014391535852*^9, 
   3.683014493353087*^9, 3.683016284345633*^9, 3.683016413292927*^9, 
   3.683016558300462*^9, 3.683016747864352*^9, 3.6830168542093143`*^9, 
   3.683016905982712*^9, 3.683017339095727*^9, 3.683017445086112*^9, 
   3.68301913718335*^9, 3.683019463703772*^9, 3.683019505213647*^9, 
   3.683020289219034*^9, 3.683020345443145*^9, 3.683020395150717*^9, 
   3.683020640877124*^9, 3.68302192475531*^9, 3.683021986669157*^9, {
   3.683022201888751*^9, 3.6830222804428253`*^9}, 3.683026284154314*^9, 
   3.6830272335256777`*^9, 3.683027305633194*^9, 3.683027627906042*^9, 
   3.683027670738612*^9, 3.683028537015099*^9, 3.68302874601842*^9, 
   3.6830293810645647`*^9, 3.683030320351701*^9, 3.6830307677854958`*^9, 
   3.683030800176774*^9, 3.6831147873455753`*^9, 3.683116788146852*^9, 
   3.683116986710854*^9, 3.6831171598856297`*^9, 3.683117605462597*^9, 
   3.683117908421276*^9, 3.683120212805458*^9, 3.683120414481056*^9, 
   3.683135745490184*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Recursions", "Subsection",
 CellChangeTimes->{{3.683011353323627*^9, 3.6830113559315653`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"dfaimmdt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"s", "[", "ei", "]"}]}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"3", "-", "ei"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "imm"}], "]"}]}], "-", 
    RowBox[{
     RowBox[{"mu", "[", "a", "]"}], 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"pad", "[", 
        RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "a", "]"}], 
     RowBox[{"pad", "[", 
      RowBox[{"ei", ",", "a", ",", "phil"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"pad", "[", 
         RowBox[{"ei", ",", "m", ",", "phil"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"pad", "[", 
         RowBox[{"ei", ",", "m", ",", "imm"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}]}], ")"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dfmimmdt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"s", "[", "ei", "]"}]}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"3", "-", "ei"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "imm"}], "]"}]}], "-", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"pmd", "[", 
        RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "a", "]"}], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"pmd", "[", 
         RowBox[{"ei", ",", "a", ",", "phil"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"pmd", "[", 
         RowBox[{"ei", ",", "a", ",", "imm"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], 
     RowBox[{"pmd", "[", 
      RowBox[{"ei", ",", "m", ",", "phil"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dfaphildt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"s", "[", "ei", "]"}]}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"3", "-", "ei"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "m", ",", "phil"}], "]"}]}], "-", 
    RowBox[{
     RowBox[{"mu", "[", "a", "]"}], 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"pan", "[", 
        RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "a", "]"}], 
     RowBox[{"pan", "[", 
      RowBox[{"ei", ",", "a", ",", "imm"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"pan", "[", 
         RowBox[{"ei", ",", "m", ",", "phil"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"pan", "[", 
         RowBox[{"ei", ",", "m", ",", "imm"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}]}], ")"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dfmphildt", "[", "ei_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"s", "[", "ei", "]"}]}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"3", "-", "ei"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{
       RowBox[{"3", "-", "ei"}], ",", "a", ",", "phil"}], "]"}]}], "-", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"pmn", "[", 
        RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "a", "]"}], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"pmn", "[", 
         RowBox[{"ei", ",", "a", ",", "phil"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"pmn", "[", 
         RowBox[{"ei", ",", "a", ",", "imm"}], "]"}], 
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}]}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], 
     RowBox[{"pmn", "[", 
      RowBox[{"ei", ",", "m", ",", "imm"}], "]"}], 
     RowBox[{"f", "[", 
      RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.683011362160074*^9, 3.683011602141446*^9}, {
   3.683011633644697*^9, 3.683011866859556*^9}, {3.683011937827196*^9, 
   3.683011979635181*^9}, {3.683012070748652*^9, 3.683012426668639*^9}, {
   3.683012481619028*^9, 3.683012482925745*^9}, {3.683013004649384*^9, 
   3.683013175091045*^9}, 3.683013885533484*^9, 3.683014043457838*^9, {
   3.6830144683916473`*^9, 3.6830144692842913`*^9}, {3.6830218959868298`*^9, 
   3.683021907928649*^9}, {3.683116825909704*^9, 3.6831168259854794`*^9}, {
   3.683116865339698*^9, 3.683116866497581*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Finding equilibrium patch frequencies", "Subsection",
 CellChangeTimes->{{3.683012453034747*^9, 3.683012457562717*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"patchsys", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"dfaimmdt", "[", "ex", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dfmimmdt", "[", "ex", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dfaphildt", "[", "ex", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dfmphildt", "[", "ex", "]"}], "\[Equal]", "0"}]}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.683021933187902*^9, 3.683021983233015*^9}, {
   3.6830220230073137`*^9, 3.6830220241258717`*^9}, 3.6830221050631742`*^9, {
   3.6830221796121893`*^9, 3.6830221807615223`*^9}, {3.683116826015143*^9, 
   3.683116826022333*^9}, {3.683116866570714*^9, 3.683116866571712*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"patchconstraint", "=", 
  RowBox[{
   RowBox[{"Total", "[", "patches", "]"}], "\[Equal]", "1"}]}]], "Input",
 CellChangeTimes->{{3.683012543105485*^9, 3.683012565053678*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "+", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "m", ",", "phil"}], "]"}]}], "\[Equal]", 
  "1"}]], "Output",
 CellChangeTimes->{
  3.683012566129122*^9, 3.683012791697138*^9, {3.6830131846017036`*^9, 
   3.683013209701922*^9}, 3.6830138896718273`*^9, 3.683014050643744*^9, 
   3.683014337502552*^9, 3.683014493572218*^9, 3.683020396117649*^9, 
   3.683021925363962*^9, 3.683021987045197*^9, {3.683022202673497*^9, 
   3.683022280696015*^9}, 3.683026284660907*^9, 3.6830272338248043`*^9, 
   3.683027306165887*^9, 3.683027628418623*^9, 3.6830276711142387`*^9, 
   3.683028538032799*^9, 3.6830287465822287`*^9, 3.6830293813934402`*^9, 
   3.683030320722584*^9, 3.683030768216854*^9, 3.683030800512741*^9, 
   3.683114788057105*^9, 3.683116788429737*^9, 3.683117005978712*^9, 
   3.683117159960539*^9, 3.683117605506834*^9, 3.6831179084731607`*^9, 
   3.6831202129302197`*^9, 3.683120414538794*^9, 3.68313574554403*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"patchsys1", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"patchsys", ",", 
     RowBox[{"3", "\[Rule]", "patchconstraint"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"patchsys2", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"patchsys", ",", 
     RowBox[{"8", "\[Rule]", "patchconstraint"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"patchinitvals", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fx", ",", 
       RowBox[{"1", "/", 
        RowBox[{"Length", "[", "patches", "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"fx", ",", "patches"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"patchinitvalsT", "=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"fx", "->", 
     RowBox[{"1", "/", 
      RowBox[{"Length", "[", "patches", "]"}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"fx", ",", "patches"}], "}"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.683012569073696*^9, 3.683012591831752*^9}, {
  3.683012668719934*^9, 3.683012733815447*^9}, {3.683022228566649*^9, 
  3.683022262265697*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    FractionBox["1", "8"]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.683022202679076*^9, 3.6830222807042828`*^9}, 
   3.683026284669272*^9, 3.6830272338327837`*^9, 3.683027306174967*^9, 
   3.683027628485621*^9, 3.683027671120172*^9, 3.6830285382505703`*^9, 
   3.683028746902779*^9, 3.683029381401185*^9, 3.6830303207284822`*^9, 
   3.683030768222934*^9, 3.683030800518508*^9, 3.683114788119685*^9, 
   3.683116788435601*^9, 3.683117014515172*^9, 3.683117160010992*^9, 
   3.683117605512865*^9, 3.6831179084803333`*^9, 3.683120212939096*^9, 
   3.6831204145452137`*^9, 3.6831357455816107`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansTest", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mua_", ",", "mum_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", "ds_", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1imm_", ",", "p1phil_", ",", "p2imm_", ",", "p2phil_"}], 
     "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"patchsys1", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
      RowBox[{
       RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
      RowBox[{
       RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
      RowBox[{
       RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
      RowBox[{"d", "\[Rule]", "ds"}], ",", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"1", ",", "imm"}], "]"}], "\[Rule]", "p1imm"}], ",", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"1", ",", "phil"}], "]"}], "\[Rule]", "p1phil"}], ",", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"2", ",", "imm"}], "]"}], "\[Rule]", "p2imm"}], ",", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"2", ",", "phil"}], "]"}], "\[Rule]", "p2phil"}]}], "}"}]}], "/.",
    "patchinitvalsT"}]}]], "Input",
 CellChangeTimes->{{3.683022045553865*^9, 3.683022059249535*^9}, {
  3.683116826193385*^9, 3.683116826200148*^9}, {3.683116866716331*^9, 
  3.683116866717511*^9}, {3.683117042565126*^9, 3.6831171372794657`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ans", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mua_", ",", "mum_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", "ds_", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1imm_", ",", "p1phil_", ",", "p2imm_", ",", "p2phil_"}], 
     "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{"patchsys1", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
       RowBox[{
        RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
       RowBox[{
        RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
       RowBox[{
        RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
       RowBox[{"d", "\[Rule]", "ds"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"1", ",", "imm"}], "]"}], "\[Rule]", "p1imm"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"1", ",", "phil"}], "]"}], "\[Rule]", "p1phil"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"2", ",", "imm"}], "]"}], "\[Rule]", "p2imm"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"2", ",", "phil"}], "]"}], "\[Rule]", "p2phil"}]}], "}"}]}], 
    ",", "patchinitvals"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.683012597610072*^9, 3.6830126627519913`*^9}, {
   3.683012739670463*^9, 3.683012789002235*^9}, {3.683013191012994*^9, 
   3.6830132055464907`*^9}, {3.68301389972443*^9, 3.683013927444028*^9}, {
   3.683116826203854*^9, 3.6831168262100153`*^9}, {3.683116866723938*^9, 
   3.6831168667251463`*^9}, {3.68311704293933*^9, 3.683117104010113*^9}, 
   3.683117150576131*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansAlt", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mua_", ",", "mum_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", "ds_", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1imm_", ",", "p1phil_", ",", "p2imm_", ",", "p2phil_"}], 
     "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{"patchsys2", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
       RowBox[{
        RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
       RowBox[{
        RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
       RowBox[{
        RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
       RowBox[{"d", "\[Rule]", "ds"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"1", ",", "imm"}], "]"}], "\[Rule]", "p1imm"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"1", ",", "phil"}], "]"}], "\[Rule]", "p1phil"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"2", ",", "imm"}], "]"}], "\[Rule]", "p2imm"}], ",", 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"2", ",", "phil"}], "]"}], "\[Rule]", "p2phil"}]}], "}"}]}], 
    ",", "patchinitvals"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.683012597610072*^9, 3.6830126627519913`*^9}, {
   3.683012739670463*^9, 3.683012789002235*^9}, {3.683013191012994*^9, 
   3.6830132055464907`*^9}, {3.68301389972443*^9, 3.683013934249997*^9}, {
   3.683116826213509*^9, 3.6831168262193537`*^9}, {3.683116866731295*^9, 
   3.683116866732505*^9}, {3.683117045458611*^9, 3.6831170767009783`*^9}, 
   3.683117106737533*^9, 3.683117154673514*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ansTest", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.9"}], "}"}], ",", 
   RowBox[{"{", ".5", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0.3", ",", "0.8", ",", "0.7"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ans", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.9"}], "}"}], ",", 
   RowBox[{"{", ".5", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0.3", ",", "0.8", ",", "0.7"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ansAlt", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2.0", ",", "1.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.5", ",", "0.9"}], "}"}], ",", 
   RowBox[{"{", ".5", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0.3", ",", "0.8", ",", "0.7"}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.683012793238723*^9, 3.683012810947023*^9}, {
  3.6830139375642567`*^9, 3.683013943093238*^9}, {3.683014677670369*^9, 
  3.683014694796183*^9}, {3.683022063541267*^9, 3.683022065502137*^9}, {
  3.683022272219922*^9, 3.6830222786509647`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "False", ",", "False", ",", "True", ",", "False", ",", "False", ",", 
   "False", ",", "False", ",", "False"}], "}"}]], "Output",
 CellChangeTimes->{
  3.6830128112567472`*^9, {3.6830131848274117`*^9, 3.683013210162569*^9}, {
   3.683013889851186*^9, 3.6830139434574347`*^9}, 3.683014050789872*^9, 
   3.683014337584845*^9, 3.68301449369119*^9, {3.6830146820968237`*^9, 
   3.6830146954791193`*^9}, 3.683020396380959*^9, 3.6830219259203997`*^9, 
   3.6830219872229567`*^9, 3.6830220659214363`*^9, {3.68302220307537*^9, 
   3.6830222807484426`*^9}, 3.683026284738268*^9, 3.683027233900497*^9, 
   3.683027306510331*^9, 3.683027628550473*^9, 3.683027671190425*^9, 
   3.683028538374329*^9, 3.683028746986281*^9, 3.683029381461101*^9, 
   3.683030320773324*^9, 3.6830307682821913`*^9, 3.683030800565055*^9, 
   3.68311478834235*^9, 3.683116788473503*^9, 3.683117160146739*^9, 
   3.683117605558148*^9, 3.683117908530546*^9, 3.683120213001176*^9, 
   3.683120414611021*^9, 3.683135745632526*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "0.12541897219166526`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "0.11572419948407572`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.19226642535065167`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.20944754583075026`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "0.07687855137188616`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "0.07738169969455107`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.10084023889333463`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.10204236718308529`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6830128112567472`*^9, {3.6830131848274117`*^9, 3.683013210162569*^9}, {
   3.683013889851186*^9, 3.6830139434574347`*^9}, 3.683014050789872*^9, 
   3.683014337584845*^9, 3.68301449369119*^9, {3.6830146820968237`*^9, 
   3.6830146954791193`*^9}, 3.683020396380959*^9, 3.6830219259203997`*^9, 
   3.6830219872229567`*^9, 3.6830220659214363`*^9, {3.68302220307537*^9, 
   3.6830222807484426`*^9}, 3.683026284738268*^9, 3.683027233900497*^9, 
   3.683027306510331*^9, 3.683027628550473*^9, 3.683027671190425*^9, 
   3.683028538374329*^9, 3.683028746986281*^9, 3.683029381461101*^9, 
   3.683030320773324*^9, 3.6830307682821913`*^9, 3.683030800565055*^9, 
   3.68311478834235*^9, 3.683116788473503*^9, 3.683117160146739*^9, 
   3.683117605558148*^9, 3.683117908530546*^9, 3.683120213001176*^9, 
   3.683120414611021*^9, 3.6831357456602583`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "0.12541897219166526`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "0.1157241994840757`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.19226642535065167`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.20944754583075026`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "0.07687855137188616`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "0.07738169969455107`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.10084023889333464`"}], ",", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.10204236718308532`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6830128112567472`*^9, {3.6830131848274117`*^9, 3.683013210162569*^9}, {
   3.683013889851186*^9, 3.6830139434574347`*^9}, 3.683014050789872*^9, 
   3.683014337584845*^9, 3.68301449369119*^9, {3.6830146820968237`*^9, 
   3.6830146954791193`*^9}, 3.683020396380959*^9, 3.6830219259203997`*^9, 
   3.6830219872229567`*^9, 3.6830220659214363`*^9, {3.68302220307537*^9, 
   3.6830222807484426`*^9}, 3.683026284738268*^9, 3.683027233900497*^9, 
   3.683027306510331*^9, 3.683027628550473*^9, 3.683027671190425*^9, 
   3.683028538374329*^9, 3.683028746986281*^9, 3.683029381461101*^9, 
   3.683030320773324*^9, 3.6830307682821913`*^9, 3.683030800565055*^9, 
   3.68311478834235*^9, 3.683116788473503*^9, 3.683117160146739*^9, 
   3.683117605558148*^9, 3.683117908530546*^9, 3.683120213001176*^9, 
   3.683120414611021*^9, 3.683135745685741*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Reproductive values", "Section",
 CellChangeTimes->{{3.683024555555551*^9, 3.683024557466881*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"rvals", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "state", ",", "immstate"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"state", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immstate", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}], ",", "2"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.683028573096344*^9, 3.683028592520965*^9}, {
   3.683115628345644*^9, 3.683115632822501*^9}, 3.683116826234064*^9, 
   3.683116866747551*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"v", "[", 
    RowBox[{"1", ",", "a", ",", "imm"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"1", ",", "a", ",", "phil"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"1", ",", "m", ",", "imm"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"1", ",", "m", ",", "phil"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"2", ",", "a", ",", "imm"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"2", ",", "a", ",", "phil"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"2", ",", "m", ",", "imm"}], "]"}], ",", 
   RowBox[{"v", "[", 
    RowBox[{"2", ",", "m", ",", "phil"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.683028594971881*^9, 3.683028747052796*^9, 
  3.683029381494812*^9, 3.6830303208221693`*^9, 3.683030768341043*^9, 
  3.683030800604653*^9, 3.6831147885148*^9, 3.6831156335560217`*^9, 
  3.683116788508102*^9, 3.6831171939318857`*^9, 3.683117285613308*^9, 
  3.683117605598476*^9, 3.683117908571837*^9, 3.6831202130965977`*^9, 
  3.683120414659226*^9, 3.6831357457118053`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaddt", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "m", ",", "imm"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"1", ",", "imm"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"2", ",", "imm"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
  3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
  3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
  3.6830260277066393`*^9, 3.683026036598381*^9}, {3.683027616062023*^9, 
  3.6830276161969433`*^9}, {3.683028741684236*^9, 3.683028742406701*^9}, {
  3.683116826245781*^9, 3.683116826285715*^9}, {3.683116866759336*^9, 
  3.683116866768108*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmddt", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "a", ",", "imm"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"2", ",", "imm"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"1", ",", "imm"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
  3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
  3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
  3.683025732034121*^9, 3.6830257866361027`*^9}, {3.683026043871243*^9, 
  3.683026053533383*^9}, {3.683027622540269*^9, 3.6830276226747837`*^9}, {
  3.68302873979867*^9, 3.6830287404086323`*^9}, {3.683116826292961*^9, 
  3.683116826332551*^9}, {3.6831168667754*^9, 3.683116866784211*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvandt", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "m", ",", "phil"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"1", ",", "phil"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"2", ",", "phil"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
   3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
   3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
   3.683025876433309*^9, 3.683025891200384*^9}, {3.6830259483265944`*^9, 
   3.683026018468545*^9}, 3.683027624172846*^9, {3.683028737490789*^9, 
   3.683028738438768*^9}, {3.683116826339926*^9, 3.683116826352929*^9}, {
   3.683116866791568*^9, 3.683116866992909*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmndt", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "a", ",", "phil"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"2", ",", "phil"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{"1", ",", "phil"}], "]"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"p", "[", 
            RowBox[{
             RowBox[{"phen", "[", 
              RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
  3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
  3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
  3.683025876433309*^9, 3.683025891200384*^9}, {3.6830259483265944`*^9, 
  3.683026018468545*^9}, {3.6830260776112623`*^9, 3.6830261507276297`*^9}, {
  3.6830272072231913`*^9, 3.68302720852744*^9}, {3.683027625708343*^9, 
  3.683027625838756*^9}, {3.6830287351808853`*^9, 3.683028735495842*^9}, {
  3.683116826360176*^9, 3.6831168263730803`*^9}, {3.683116867005117*^9, 
  3.6831168672128897`*^9}}],

Cell[CellGroupData[{

Cell["Finding equilibrium reproductive values", "Subsection",
 CellChangeTimes->{{3.683026166679122*^9, 3.6830261694795523`*^9}, {
  3.6831172092510643`*^9, 3.6831172121216803`*^9}}],

Cell["System of equations", "Text",
 CellChangeTimes->{{3.683026308715526*^9, 3.683026311018876*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rvsys", "=", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"dvaddt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dvmddt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dvandt", "[", "ei", "]"}], "\[Equal]", "0"}], ",", 
        RowBox[{
         RowBox[{"dvmndt", "[", "ei", "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
      
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}]}], "]"}], "//", 
    "Flatten"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6830261602493467`*^9, 3.6830261607527027`*^9}, {
  3.683026241424324*^9, 3.6830263168679857`*^9}}],

Cell["Note that RVs have a reduced rank, so add a constraint:", "Text",
 CellChangeTimes->{{3.683026320987541*^9, 3.683026335434791*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"rvconstraint", "=", 
  RowBox[{
   RowBox[{"Total", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"ei", ",", "state", ",", "immstate"}], "]"}], 
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "state", ",", "immstate"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"ei", ",", "1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"state", ",", 
         RowBox[{"{", 
          RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"immstate", ",", 
         RowBox[{"{", 
          RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}], "]"}], "]"}],
    "\[Equal]", "1"}]}]], "Input",
 CellChangeTimes->{{3.683026337199143*^9, 3.683026441915001*^9}, 
   3.683116826396817*^9, 3.683116867244362*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], " ", 
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}]}]}], "\[Equal]", 
  "1"}]], "Output",
 CellChangeTimes->{{3.683026420248432*^9, 3.683026442338269*^9}, 
   3.683027234082526*^9, 3.683027306660099*^9, 3.683027628902647*^9, 
   3.683027671313899*^9, 3.6830287473510017`*^9, 3.683029381917568*^9, 
   3.683030321180479*^9, 3.68303076874715*^9, 3.683030800776956*^9, 
   3.683114790454689*^9, 3.683116788813553*^9, 3.683117216266102*^9, 
   3.6831172859199047`*^9, 3.683117605653472*^9, 3.683117908639407*^9, 
   3.683120213180225*^9, 3.683120414736796*^9, 3.683135745765684*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"rvsys1", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"rvsys", ",", 
     RowBox[{"1", "\[Rule]", "rvconstraint"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rvsys2", "=", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"rvsys", ",", 
     RowBox[{"3", "\[Rule]", "rvconstraint"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"rvinitvals", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"ei", ",", "state", ",", "immstate"}], "]"}], ",", "1"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"ei", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"state", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immstate", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}], ",", "2"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.68302659426536*^9, 3.683026612455225*^9}, {
   3.6830266571374083`*^9, 3.683026694500959*^9}, 3.683116826407399*^9, 
   3.683116867260715*^9, {3.683117224880692*^9, 3.6831172258216476`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"1", ",", "a", ",", "imm"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"1", ",", "a", ",", "phil"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"1", ",", "m", ",", "imm"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"1", ",", "m", ",", "phil"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"2", ",", "a", ",", "imm"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"2", ",", "a", ",", "phil"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"2", ",", "m", ",", "imm"}], "]"}], ",", "1"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"v", "[", 
      RowBox[{"2", ",", "m", ",", "phil"}], "]"}], ",", "1"}], "}"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.683026680914217*^9, 3.683026694919578*^9}, 
   3.683027234089332*^9, 3.6830273066655684`*^9, 3.68302762890863*^9, 
   3.6830276713193903`*^9, 3.683028747356296*^9, 3.683029381923316*^9, 
   3.6830303211873198`*^9, 3.683030768753106*^9, 3.683030800782817*^9, 
   3.683114790459618*^9, 3.683116788819824*^9, 3.683117226561582*^9, 
   3.6831172859275312`*^9, 3.68311760565963*^9, 3.6831179086455297`*^9, 
   3.683120213187798*^9, 3.6831204147428417`*^9, 3.6831357457892942`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansRV", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mua_", ",", "mum_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", "ds_", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1imm_", ",", "p1phil_", ",", "p2imm_", ",", "p2phil_"}], 
     "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"rvsys1", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"1", ",", "imm"}], "]"}], "\[Rule]", "p1imm"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"1", ",", "phil"}], "]"}], "\[Rule]", "p1phil"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"2", ",", "imm"}], "]"}], "\[Rule]", "p2imm"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"2", ",", "phil"}], "]"}], "\[Rule]", "p2phil"}]}], "}"}]}],
      "/.", 
     RowBox[{"ans", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mua", ",", "mum"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s1", ",", "s2"}], "}"}], ",", 
       RowBox[{"{", "ds", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1imm", ",", "p1phil", ",", "p2imm", ",", "p2phil"}], 
        "}"}]}], "]"}]}], ",", "rvinitvals"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.683026448074452*^9, 3.6830264489307528`*^9}, {
   3.683026556352536*^9, 3.6830265926672373`*^9}, {3.683026627323811*^9, 
   3.683026654919586*^9}, {3.6830267010596247`*^9, 3.683026711932106*^9}, 
   3.6830267679081306`*^9, {3.683116826417131*^9, 3.683116826422532*^9}, {
   3.683116867275012*^9, 3.6831168672770042`*^9}, {3.683117047388748*^9, 
   3.683117076633773*^9}, {3.683117238220768*^9, 3.683117272497137*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ansRValt", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mua_", ",", "mum_"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s1_", ",", "s2_"}], "}"}], ",", 
    RowBox[{"{", "ds_", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"p1imm_", ",", "p1phil_", ",", "p2imm_", ",", "p2phil_"}], 
     "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"FindRoot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"rvsys2", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"mu", "[", "a", "]"}], "\[Rule]", "mua"}], ",", 
        RowBox[{
         RowBox[{"mu", "[", "m", "]"}], "\[Rule]", "mum"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "1", "]"}], "\[Rule]", "s1"}], ",", 
        RowBox[{
         RowBox[{"s", "[", "2", "]"}], "\[Rule]", "s2"}], ",", 
        RowBox[{"d", "\[Rule]", "ds"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"1", ",", "imm"}], "]"}], "\[Rule]", "p1imm"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"1", ",", "phil"}], "]"}], "\[Rule]", "p1phil"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"2", ",", "imm"}], "]"}], "\[Rule]", "p2imm"}], ",", 
        RowBox[{
         RowBox[{"p", "[", 
          RowBox[{"2", ",", "phil"}], "]"}], "\[Rule]", "p2phil"}]}], "}"}]}],
      "/.", 
     RowBox[{"ans", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mua", ",", "mum"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"s1", ",", "s2"}], "}"}], ",", 
       RowBox[{"{", "ds", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"p1imm", ",", "p1phil", ",", "p2imm", ",", "p2phil"}], 
        "}"}]}], "]"}]}], ",", "rvinitvals"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.683026448074452*^9, 3.6830264489307528`*^9}, {
  3.683026556352536*^9, 3.6830265926672373`*^9}, {3.683026627323811*^9, 
  3.683026654919586*^9}, {3.6830267010596247`*^9, 3.683026711932106*^9}, {
  3.6830267438195953`*^9, 3.683026770777878*^9}, {3.683116826429089*^9, 
  3.683116826434392*^9}, {3.683116867279286*^9, 3.6831168672811537`*^9}, {
  3.6831170481979303`*^9, 3.683117076667818*^9}, {3.683117242683654*^9, 
  3.683117279595008*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ansRV", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1.0", ",", "2.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0.8"}], "}"}], ",", 
   RowBox[{"{", "0.8", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0.2", ",", "0.3", ",", "0.5"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ansRValt", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"1.0", ",", "2.0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.2", ",", "0.8"}], "}"}], ",", 
   RowBox[{"{", "0.8", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0.2", ",", "0.3", ",", "0.5"}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.683026713960181*^9, 3.683026728808804*^9}, {
  3.6830267620012827`*^9, 3.68302676505786*^9}, {3.683026854954213*^9, 
  3.683026865207527*^9}, {3.6830272375052633`*^9, 3.6830272396543207`*^9}, {
  3.683027583593758*^9, 3.683027597504119*^9}, {3.6830294918686333`*^9, 
  3.683029493845083*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "1.2107591069100763`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "1.2512353758426122`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.8106579164958521`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.8633687060299243`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "1.1309714677513194`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "1.189196757682605`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.9020377957121084`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.9228853788168376`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.683026729132886*^9, 3.683026773839023*^9, {3.683026857060893*^9, 
   3.683026865723612*^9}, {3.683027234130137*^9, 3.683027240204172*^9}, 
   3.683027306722575*^9, {3.68302758837152*^9, 3.6830275978151484`*^9}, 
   3.683027628976593*^9, 3.683027671375017*^9, 3.683028747486559*^9, 
   3.683029381961124*^9, 3.6830294948669453`*^9, 3.683030321240192*^9, 
   3.683030768819274*^9, 3.6830308009784937`*^9, 3.683114790542493*^9, 
   3.6831167888546057`*^9, 3.683117286001462*^9, 3.683117605701326*^9, 
   3.683117908688662*^9, 3.683120213242529*^9, 3.683120414790605*^9, 
   3.68313574582474*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "1.2107591069100765`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "1.2512353758426116`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.8106579164958521`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.8633687060299244`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "\[Rule]", 
    "1.1309714677513194`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "\[Rule]", 
    "1.189196757682605`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "\[Rule]", 
    "0.9020377957121084`"}], ",", 
   RowBox[{
    RowBox[{"v", "[", 
     RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "\[Rule]", 
    "0.9228853788168374`"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.683026729132886*^9, 3.683026773839023*^9, {3.683026857060893*^9, 
   3.683026865723612*^9}, {3.683027234130137*^9, 3.683027240204172*^9}, 
   3.683027306722575*^9, {3.68302758837152*^9, 3.6830275978151484`*^9}, 
   3.683027628976593*^9, 3.683027671375017*^9, 3.683028747486559*^9, 
   3.683029381961124*^9, 3.6830294948669453`*^9, 3.683030321240192*^9, 
   3.683030768819274*^9, 3.6830308009784937`*^9, 3.683114790542493*^9, 
   3.6831167888546057`*^9, 3.683117286001462*^9, 3.683117605701326*^9, 
   3.683117908688662*^9, 3.683120213242529*^9, 3.683120414790605*^9, 
   3.683135745842524*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Selection gradients", "Section",
 CellChangeTimes->{{3.683029392061887*^9, 3.683029394084929*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvaddt\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "m", ",", "imm"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "imm"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"1", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"1", ",", "imm"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"1", ",", "imm"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"2", ",", "imm"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"2", ",", "imm"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "imm"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"2", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.68302950257743*^9, 3.683029662252*^9}, {
  3.6831168264481792`*^9, 3.683116826517845*^9}, {3.683116867298571*^9, 
  3.683116867311554*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmddt\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "a", ",", "imm"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "imm"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"2", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"2", ",", "imm"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"2", ",", "imm"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"1", ",", "imm"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"1", ",", "imm"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "imm"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"1", ",", "imm"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}], "+", 
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "imm"}], "]"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
  3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
  3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
  3.683025732034121*^9, 3.6830257866361027`*^9}, {3.683026043871243*^9, 
  3.683026053533383*^9}, {3.683027622540269*^9, 3.6830276226747837`*^9}, {
  3.68302873979867*^9, 3.6830287404086323`*^9}, {3.683029686589691*^9, 
  3.683029762862987*^9}, {3.683030733618848*^9, 3.683030748590333*^9}, {
  3.683116826525951*^9, 3.6831168265967007`*^9}, {3.68311686732102*^9, 
  3.6831168673330307`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvandt\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "m", ",", "phil"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "phil"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"1", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"1", ",", "phil"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"1", ",", "phil"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"2", ",", "phil"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"2", ",", "phil"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "phil"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"2", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "a", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}], "+", 
               
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}], "+", 
               
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "a"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
   3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
   3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
   3.683025876433309*^9, 3.683025891200384*^9}, {3.6830259483265944`*^9, 
   3.683026018468545*^9}, 3.683027624172846*^9, {3.683028737490789*^9, 
   3.683028738438768*^9}, {3.6830297916025543`*^9, 3.683029840681175*^9}, {
   3.683030019403915*^9, 3.683030061937477*^9}, {3.683030215385686*^9, 
   3.683030223918971*^9}, {3.6831168266045856`*^9, 3.6831168266195717`*^9}, {
   3.683116867341888*^9, 3.6831168674075527`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dvmndt\[Delta]p", "[", "ei_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"s", "[", "ei", "]"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{
        RowBox[{"3", "-", "ei"}], ",", "a", ",", "phil"}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], 
    RowBox[{"(", 
     RowBox[{"1", "-", "d"}], ")"}], 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ei", "\[Equal]", "1"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"2", ",", "phil"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"2", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"2", ",", "phil"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"2", ",", "phil"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"p", "[", 
               RowBox[{"1", ",", "phil"}], "]"}], "+", 
              RowBox[{"\[Delta]p", "[", 
               RowBox[{"1", ",", "phil"}], "]"}]}], ")"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "a", ",", "phil"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"p", "[", 
             RowBox[{"1", ",", "phil"}], "]"}], "+", 
            RowBox[{"\[Delta]p", "[", 
             RowBox[{"1", ",", "phil"}], "]"}]}], ")"}], 
          RowBox[{"v", "[", 
           RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}]}]}], "]"}], "-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{
    RowBox[{"mu", "[", "m", "]"}], "d", 
    RowBox[{"(", 
     RowBox[{"-", 
      RowBox[{"v", "[", 
       RowBox[{"ei", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
   RowBox[{"d", " ", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"ex", ",", "statex", ",", "immx"}], "]"}], 
       RowBox[{"mu", "[", "statex", "]"}], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ex", "\[Equal]", "1"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}], "+", 
               
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}], "+", 
               
               RowBox[{"\[Delta]p", "[", 
                RowBox[{
                 RowBox[{"phen", "[", 
                  RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}]}], 
              ")"}]}], ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "a", ",", "imm"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}], "+", 
             RowBox[{"\[Delta]p", "[", 
              RowBox[{
               RowBox[{"phen", "[", 
                RowBox[{"ei", ",", "m"}], "]"}], ",", "phil"}], "]"}]}], 
            ")"}], 
           RowBox[{"v", "[", 
            RowBox[{"ex", ",", "m", ",", "imm"}], "]"}]}]}]}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"ex", ",", "1", ",", "2"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"statex", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "m"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"immx", ",", 
        RowBox[{"{", 
         RowBox[{"imm", ",", "phil"}], "}"}]}], "}"}]}], "]"}]}]}]}]], "Input",\

 CellChangeTimes->{{3.683024578782589*^9, 3.683024621559958*^9}, {
  3.6830246866707153`*^9, 3.683024726911203*^9}, {3.68302509202367*^9, 
  3.68302535445444*^9}, {3.6830254821960363`*^9, 3.683025701854726*^9}, {
  3.683025876433309*^9, 3.683025891200384*^9}, {3.6830259483265944`*^9, 
  3.683026018468545*^9}, {3.6830260776112623`*^9, 3.6830261507276297`*^9}, {
  3.6830272072231913`*^9, 3.68302720852744*^9}, {3.683027625708343*^9, 
  3.683027625838756*^9}, {3.6830287351808853`*^9, 3.683028735495842*^9}, {
  3.683030250591066*^9, 3.6830303152803783`*^9}, {3.683030753581916*^9, 
  3.683030765202882*^9}, {3.68311682662739*^9, 3.6831168266424522`*^9}, {
  3.683116867415882*^9, 3.683116867480208*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"dpvals0", "=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Delta]p", "[", 
       RowBox[{"pheni", ",", "immstate"}], "]"}], "\[Rule]", "0"}], ",", 
     RowBox[{"{", 
      RowBox[{"pheni", ",", "1", ",", "2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"immstate", ",", 
       RowBox[{"{", 
        RowBox[{"phil", ",", "imm"}], "}"}]}], "}"}]}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.683114969038753*^9, 3.683115024985026*^9}, 
   3.683116826648543*^9, 3.683116867486372*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Delta]p", "[", 
     RowBox[{"1", ",", "phil"}], "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{"\[Delta]p", "[", 
     RowBox[{"1", ",", "imm"}], "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{"\[Delta]p", "[", 
     RowBox[{"2", ",", "phil"}], "]"}], "\[Rule]", "0"}], ",", 
   RowBox[{
    RowBox[{"\[Delta]p", "[", 
     RowBox[{"2", ",", "imm"}], "]"}], "\[Rule]", "0"}]}], "}"}]], "Output",
 CellChangeTimes->{3.683115025440215*^9, 3.6831167889127407`*^9, 
  3.683117314402109*^9, 3.683117605768436*^9, 3.683117908759818*^9, 
  3.683120213331493*^9, 3.683120414874453*^9, 3.683135745895645*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"grad", "[", "x_", "]"}], ":=", 
  RowBox[{
   RowBox[{"D", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", "a", ",", "imm"}], "]"}], 
         RowBox[{"dvaddt\[Delta]p", "[", "ex", "]"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", "m", ",", "imm"}], "]"}], 
         RowBox[{"dvmddt\[Delta]p", "[", "ex", "]"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", "a", ",", "phil"}], "]"}], 
         RowBox[{"dvandt\[Delta]p", "[", "ex", "]"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"ex", ",", "m", ",", "phil"}], "]"}], 
         RowBox[{"dvmndt\[Delta]p", "[", "ex", "]"}]}]}], ",", 
       RowBox[{"{", 
        RowBox[{"ex", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", "x"}], "]"}],
    "/.", "dpvals0"}]}]], "Input",
 CellChangeTimes->{{3.6831147457554913`*^9, 3.6831147780001173`*^9}, {
  3.683114828928207*^9, 3.683114967686386*^9}, {3.683115029581324*^9, 
  3.683115044868232*^9}, {3.6831151616706343`*^9, 3.6831151814353247`*^9}, {
  3.6831168266574383`*^9, 3.6831168266625557`*^9}, {3.683116867499214*^9, 
  3.6831168675004883`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"grad", "[", 
  RowBox[{"\[Delta]p", "[", 
   RowBox[{"2", ",", "phil"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.683115184386568*^9, 3.683115216620778*^9}, {
   3.683115265546425*^9, 3.683115285474615*^9}, 3.6831168675087767`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "m", ",", "phil"}], "]"}], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], " ", 
      RowBox[{"mu", "[", "m", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"v", "[", 
         RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "-", 
        RowBox[{"v", "[", 
         RowBox[{"1", ",", "m", ",", "phil"}], "]"}]}], ")"}]}], "+", 
     RowBox[{"d", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "m", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "m", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "m", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "m", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}]}], 
       ")"}]}]}], ")"}]}], "+", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "a", ",", "phil"}], "]"}], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"d", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "a", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "m", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"1", ",", "m", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "-", 
           RowBox[{"v", "[", 
            RowBox[{"1", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "a", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "a", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "m", ",", "imm"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}], "+", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"2", ",", "m", ",", "phil"}], "]"}], " ", 
         RowBox[{"mu", "[", "m", "]"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"v", "[", 
             RowBox[{"2", ",", "a", ",", "imm"}], "]"}]}], "+", 
           RowBox[{"v", "[", 
            RowBox[{"2", ",", "m", ",", "imm"}], "]"}]}], ")"}]}]}], ")"}]}], 
     "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", "d"}], ")"}], " ", 
      RowBox[{"mu", "[", "a", "]"}], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"v", "[", 
          RowBox[{"2", ",", "a", ",", "phil"}], "]"}]}], "+", 
        RowBox[{"v", "[", 
         RowBox[{"2", ",", "m", ",", "phil"}], "]"}]}], ")"}]}]}], 
    ")"}]}]}]], "Output",
 CellChangeTimes->{{3.6831151881591263`*^9, 3.68311521479027*^9}, {
   3.6831152740193233`*^9, 3.6831152860280247`*^9}, 3.683116788988344*^9, 
   3.6831173144785223`*^9, 3.6831176058039207`*^9, 3.6831179087993317`*^9, 
   3.6831202133924837`*^9, 3.6831204149237022`*^9, 3.683135745925632*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export to C for numerical iterations", "Section",
 CellChangeTimes->{{3.682789698615266*^9, 3.682789708221863*^9}}],

Cell["Directory for the exported files", "Text",
 CellChangeTimes->{{3.6827897268767242`*^9, 3.6827897361085033`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dir", "=", 
   RowBox[{
   "$HomeDirectory", "<>", 
    "\"\</Projects/dispersal_status/src/numerical/1player/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"toC", "[", "str_", "]"}], ":=", 
   RowBox[{"ToString", "[", 
    RowBox[{"CForm", "[", "str", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.682789737490488*^9, 3.68278975607978*^9}, {
  3.6827902410896673`*^9, 3.6827902431701603`*^9}, {3.682790331382429*^9, 
  3.682790344876502*^9}, {3.683031009738223*^9, 3.68303101500718*^9}}],

Cell["Patch frequencies", "Text",
 CellChangeTimes->{{3.6827897156456833`*^9, 3.6827897196132*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"str", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<double dfaimm1dttplus1, dfaimm2dttplus1, dfmimm1dttplus1, \
dfmimm2dttplus1, dfaphil1dttplus1, dfaphil2dttplus1, dfmphil1dttplus1, \
dfmphil2dttplus1;\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", "\"\<for (int iter=0; iter<1e08; ++iter) {\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfaimm1dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"Total", "[", 
        RowBox[{"patches", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", 
           RowBox[{"Length", "[", "patches", "]"}]}], "]"}], "]"}], "]"}]}], 
      ")"}], "]"}], "<>", "\"\<);\\n\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfaimm2dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfaimmdt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfmimm1dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfmimmdt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfmimm2dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfmimmdt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfaphil1dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfaphildt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfaphil2dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfaphildt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfmphil1dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfmphildt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dfmphil2dttplus1 = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dfmphildt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<if (\nfabs(dfaimm1dttplus1 - f[1,a,imm]) < 1e-07 \n&& \
fabs(dfaimm2dttplus1 - f[2,a,imm]) < 1e-07 \n&& fabs(dfmimm1dttplus1 - \
f[1,m,imm]) < 1e-07 \n&& fabs(dfmimm2dttplus1 - f[2,m,imm]) < 1e-07\n&& \
fabs(dfaphil1dttplus1 - f[1,a,phil]) < 1e-07 \n&& fabs(dfaphil2dttplus1 - \
f[2,a,phil]) < 1e-07 \n&& fabs(dfmphil1dttplus1 - f[1,m,phil]) < 1e-07 \n&& \
fabs(dfmphil2dttplus1 - f[2,m,phil]) < 1e-07) {\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<break;\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<}\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<\nf[1,a,imm] = dfaimm1dttplus1;\nf[2,a,imm] = dfaimm2dttplus1;\n\
f[1,m,imm] = dfmimm1dttplus1;\nf[2,m,imm] = dfmimm2dttplus1;\nf[1,a,phil] = \
dfaphil1dttplus1;\nf[2,a,phil] = dfaphil2dttplus1;\nf[1,m,phil] = \
dfmphil1dttplus1;\nf[2,m,phil] = dfmphil2dttplus1;\>\""}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<}\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<\ngsl_vector_set(f, 0, f[1,a,imm]);\ngsl_vector_set(f, 1, \
f[2,a,imm]);\ngsl_vector_set(f, 2, f[1,m,imm]);\ngsl_vector_set(f, 3, \
f[2,m,imm]);\ngsl_vector_set(f, 4, f[1,a,phil]);\ngsl_vector_set(f, 5, \
f[2,a,phil]);\ngsl_vector_set(f, 6, f[1,m,phil]);\ngsl_vector_set(f, 7, \
f[2,m,phil]);\>\""}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6827902469431267`*^9, 3.6827903961329393`*^9}, {
   3.68279045538764*^9, 3.682790612353447*^9}, {3.6827906511096697`*^9, 
   3.682790652087944*^9}, {3.682790698750043*^9, 3.6827907697864647`*^9}, {
   3.682790932188768*^9, 3.682791005539283*^9}, {3.682791089305035*^9, 
   3.68279111423083*^9}, {3.6827926146030817`*^9, 3.682792615699706*^9}, {
   3.683113500714604*^9, 3.683113613684785*^9}, {3.683113781598754*^9, 
   3.683113938488595*^9}, {3.683113976841631*^9, 3.68311428152599*^9}, {
   3.683114656994916*^9, 3.683114667265221*^9}, {3.683116826686602*^9, 
   3.683116826781166*^9}, {3.683116867527645*^9, 3.683116867615418*^9}, {
   3.6831173233196907`*^9, 3.6831173891318502`*^9}, {3.683117421046344*^9, 
   3.68311743149927*^9}, {3.683118102699856*^9, 3.683118102899143*^9}, {
   3.6831194439206953`*^9, 3.683119474519949*^9}, 3.683120406406657*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"dir", "<>", "\"\<patchrecurs.txt\>\""}], ",", "str"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.682789722862713*^9, 3.682789723751486*^9}, {
  3.682790776559287*^9, 3.682790783864439*^9}, {3.682790881171773*^9, 
  3.68279091384346*^9}}],

Cell["Reproductive values", "Text",
 CellChangeTimes->{{3.682791012522871*^9, 3.682791014490178*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"str", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<double dvaimm1dttplus1, dvaimm2dttplus1, dvmimm1dttplus1, \
dvmimm2dttplus1, dvaphil1dttplus1, dvaphil2dttplus1, dvmphil1dttplus1, \
dvmphil2dttplus1;\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", "\"\<for (int iter=0; iter<1e08; ++iter) {\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvaimm1dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "a", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvaddt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvaimm2dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"2", ",", "a", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvaddt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvmimm1dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "m", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvmddt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvmimm2dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"2", ",", "m", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvmddt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvaphil1dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "a", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvandt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvaphil2dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"2", ",", "a", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvandt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvmphil1dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"1", ",", "m", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvmndt", "[", "1", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<dvmphil2dttplus1 = bound0(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"v", "[", 
       RowBox[{"2", ",", "m", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"dvmndt", "[", "2", "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<if (\nfabs(dvaimm1dttplus1 - v[1,a,imm]) < 1e-07 \n&& \
fabs(dvaimm2dttplus1 - v[2,a,imm]) < 1e-07 \n&& fabs(dvmimm1dttplus1 - \
v[1,m,imm]) < 1e-07 \n&& fabs(dvmimm2dttplus1 - v[2,m,imm]) < 1e-07\n&& \
fabs(dvaphil1dttplus1 - v[1,a,phil]) < 1e-07 \n&& fabs(dvaphil2dttplus1 - \
v[2,a,phil]) < 1e-07 \n&& fabs(dvmphil1dttplus1 - v[1,m,phil]) < 1e-07 \n&& \
fabs(dvmphil2dttplus1 - v[2,m,phil]) < 1e-07) {\\n\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<break;\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<}\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<\nv[1,a,imm] = dvaimm1dttplus1;\nv[2,a,imm] = dvaimm2dttplus1;\n\
v[1,m,imm] = dvmimm1dttplus1;\nv[2,m,imm] = dvmimm2dttplus1;\nv[1,a,phil] = \
dvaphil1dttplus1;\nv[2,a,phil] = dvaphil2dttplus1;\nv[1,m,phil] = \
dvmphil1dttplus1;\nv[2,m,phil] = dvmphil2dttplus1;\>\""}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<}\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<\ngsl_vector_set(f, 0, v[1,a,imm]);\ngsl_vector_set(f, 1, \
v[2,a,imm]);\ngsl_vector_set(f, 2, v[1,m,imm]);\ngsl_vector_set(f, 3, \
v[2,m,imm]);\ngsl_vector_set(f, 4, v[1,a,phil]);\ngsl_vector_set(f, 5, \
v[2,a,phil]);\ngsl_vector_set(f, 6, v[1,m,phil]);\ngsl_vector_set(f, 7, \
v[2,m,phil]);\>\""}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6827902469431267`*^9, 3.6827903961329393`*^9}, {
  3.68279045538764*^9, 3.682790612353447*^9}, {3.6827906511096697`*^9, 
  3.682790652087944*^9}, {3.682790698750043*^9, 3.6827907697864647`*^9}, {
  3.682790932188768*^9, 3.682791005539283*^9}, {3.682791089305035*^9, 
  3.68279111423083*^9}, {3.6827926146030817`*^9, 3.682792615699706*^9}, {
  3.683113500714604*^9, 3.683113613684785*^9}, {3.683113781598754*^9, 
  3.683113938488595*^9}, {3.683113976841631*^9, 3.68311428152599*^9}, {
  3.68311446922044*^9, 3.6831145143158903`*^9}, {3.683114615127365*^9, 
  3.683114701904561*^9}, {3.6831168267954187`*^9, 3.6831168268902283`*^9}, {
  3.6831168676257257`*^9, 3.683116867695706*^9}, {3.683117438402685*^9, 
  3.683117451672695*^9}, {3.683117494509309*^9, 3.6831175806814423`*^9}, {
  3.683118095659032*^9, 3.6831180958909693`*^9}, {3.683118137804344*^9, 
  3.6831181432564583`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"dir", "<>", "\"\<repvals.txt\>\""}], ",", "str"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.682791018889832*^9, 3.682791081738611*^9}, {
  3.682791120914106*^9, 3.682791351384303*^9}, {3.682792611284843*^9, 
  3.6827926117796307`*^9}, {3.682792646419422*^9, 3.6827926467981*^9}, {
  3.683114713874463*^9, 3.683114714423023*^9}}],

Cell["Selection gradients", "Text",
 CellChangeTimes->{{3.68279135567551*^9, 3.682791363473833*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"str", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<double dp1imm = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"1", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"grad", "[", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"1", ",", "imm"}], "]"}], "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<double dp1phil = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"1", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"grad", "[", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"1", ",", "phil"}], "]"}], "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<double dp2imm = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"2", ",", "imm"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"grad", "[", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"2", ",", "imm"}], "]"}], "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{"str", "<>", "\"\<double dp2phil = bound01(\>\"", "<>", 
    RowBox[{"toC", "[", 
     RowBox[{
      RowBox[{"p", "[", 
       RowBox[{"2", ",", "phil"}], "]"}], "+", 
      RowBox[{"0.01", "*", 
       RowBox[{"grad", "[", 
        RowBox[{"\[Delta]p", "[", 
         RowBox[{"2", ",", "phil"}], "]"}], "]"}]}]}], "]"}], "<>", 
    "\"\<);\\n\\n\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", 
   RowBox[{
   "str", "<>", 
    "\"\<gsl_vector_set(f, 0, dp1imm);\\ngsl_vector_set(f, 1, \
dp1phil);\\ngsl_vector_set(f, 2, dp2imm);\\ngsl_vector_set(f, 3, dp2phil);\\n\
\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"dir", "<>", "\"\<selgrad.txt\>\""}], ",", "str"}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.682791364582546*^9, 3.682791406099321*^9}, {
   3.68279144656254*^9, 3.6827916096197557`*^9}, 3.6827925977719707`*^9, {
   3.6828370900923862`*^9, 3.682837090136817*^9}, {3.683115309811139*^9, 
   3.683115464908841*^9}, {3.6831162878563633`*^9, 3.683116296322247*^9}, {
   3.683116826901463*^9, 3.6831168269152308`*^9}, {3.683116865070966*^9, 
   3.683116865079035*^9}, {3.6831175852384377`*^9, 3.6831176010806227`*^9}, {
   3.6831223556323*^9, 3.683122370055593*^9}, {3.6831226958065767`*^9, 
   3.683122700347793*^9}}],

Cell["Parameters", "Text",
 CellChangeTimes->{{3.68279161412716*^9, 3.682791615861644*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"printIt", "[", "x_", "]"}], ":=", 
   RowBox[{"\"\<double \>\"", "<>", 
    RowBox[{"toC", "[", "x", "]"}], "<>", "\"\<;\\n\>\""}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.682791732865602*^9, 3.682791753923362*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pars", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"mu", "[", "m", "]"}], ",", 
     RowBox[{"mu", "[", "a", "]"}], ",", "d", ",", 
     RowBox[{"s", "[", "1", "]"}], ",", 
     RowBox[{"s", "[", "2", "]"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"variables", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"pars", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"1", ",", "imm"}], "]"}], ",", 
       RowBox[{"p", "[", 
        RowBox[{"1", ",", "phil"}], "]"}], ",", 
       RowBox[{"p", "[", 
        RowBox[{"2", ",", "imm"}], "]"}], ",", 
       RowBox[{"p", "[", 
        RowBox[{"2", ",", "phil"}], "]"}]}], "}"}], ",", "patches", ",", 
     "rvals"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.682791618416059*^9, 3.682791711864233*^9}, {
  3.683115503692308*^9, 3.6831156148935347`*^9}, {3.683115655999427*^9, 
  3.683115659062348*^9}, {3.683116826924251*^9, 3.683116826931171*^9}, {
  3.683116865087668*^9, 3.683116865089188*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"str", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ix", "=", "1"}], ",", 
    RowBox[{"ix", "\[LessEqual]", 
     RowBox[{"Length", "[", "pars", "]"}]}], ",", 
    RowBox[{"++", "ix"}], ",", 
    RowBox[{"str", "=", 
     RowBox[{"str", "<>", 
      RowBox[{"printIt", "[", 
       RowBox[{"pars", "[", 
        RowBox[{"[", "ix", "]"}], "]"}], "]"}]}]}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"dir", "<>", "\"\<params.txt\>\""}], ",", "str"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"str", "=", "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"ix", "=", "1"}], ",", 
    RowBox[{"ix", "\[LessEqual]", 
     RowBox[{"Length", "[", "variables", "]"}]}], ",", 
    RowBox[{"++", "ix"}], ",", 
    RowBox[{"str", "=", 
     RowBox[{"str", "<>", 
      RowBox[{"printIt", "[", 
       RowBox[{"variables", "[", 
        RowBox[{"[", "ix", "]"}], "]"}], "]"}]}]}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"dir", "<>", "\"\<variables.txt\>\""}], ",", "str"}], "]"}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6827917566100817`*^9, 3.6827918647221117`*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{2487, 1573},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
Magnification->1.5,
FrontEndVersion->"9.0 for Linux x86 (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 191, 2, 138, "Title"],
Cell[773, 26, 139, 2, 47, "Input"],
Cell[CellGroupData[{
Cell[937, 32, 102, 1, 120, "Section"],
Cell[1042, 35, 674, 12, 164, "Text"],
Cell[CellGroupData[{
Cell[1741, 51, 808, 21, 47, "Input"],
Cell[2552, 74, 1846, 35, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4435, 114, 911, 25, 81, "Input"],
Cell[5349, 141, 2774, 73, 120, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8160, 219, 272, 8, 47, "Input"],
Cell[8435, 229, 1982, 47, 67, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10454, 281, 103, 1, 67, "Subsection"],
Cell[10560, 284, 202, 4, 46, "Text"],
Cell[10765, 290, 683, 21, 47, "Input"],
Cell[11451, 313, 260, 5, 46, "Text"],
Cell[11714, 320, 1454, 38, 47, "Input"],
Cell[13171, 360, 275, 5, 46, "Text"],
Cell[13449, 367, 820, 22, 47, "Input"],
Cell[14272, 391, 197, 4, 46, "Text"],
Cell[14472, 397, 1859, 55, 80, "Input"],
Cell[16334, 454, 138, 1, 46, "Text"],
Cell[CellGroupData[{
Cell[16497, 459, 1109, 27, 47, "Input"],
Cell[17609, 488, 1332, 19, 46, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[18990, 513, 100, 1, 67, "Subsection"],
Cell[19093, 516, 6216, 183, 272, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25346, 704, 125, 1, 67, "Subsection"],
Cell[25474, 707, 930, 23, 47, "Input"],
Cell[CellGroupData[{
Cell[26429, 734, 198, 4, 47, "Input"],
Cell[26630, 740, 1483, 31, 46, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[28150, 776, 1158, 34, 144, "Input"],
Cell[29311, 812, 1653, 42, 67, "Output"]
}, Open  ]],
Cell[30979, 857, 1510, 40, 80, "Input"],
Cell[32492, 899, 1743, 44, 80, "Input"],
Cell[34238, 945, 1769, 44, 80, "Input"],
Cell[CellGroupData[{
Cell[36032, 993, 1204, 34, 112, "Input"],
Cell[37239, 1029, 1033, 17, 46, "Output"],
Cell[38275, 1048, 1977, 47, 77, "Output"],
Cell[40255, 1097, 1974, 47, 77, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[42290, 1151, 104, 1, 120, "Section"],
Cell[CellGroupData[{
Cell[42419, 1156, 751, 21, 47, "Input"],
Cell[43173, 1179, 1060, 24, 46, "Output"]
}, Open  ]],
Cell[44248, 1206, 4185, 117, 240, "Input"],
Cell[48436, 1325, 4230, 117, 240, "Input"],
Cell[52669, 1444, 4249, 119, 208, "Input"],
Cell[56921, 1565, 4376, 121, 208, "Input"],
Cell[CellGroupData[{
Cell[61322, 1690, 182, 2, 67, "Subsection"],
Cell[61507, 1694, 101, 1, 46, "Text"],
Cell[61611, 1697, 744, 21, 47, "Input"],
Cell[62358, 1720, 137, 1, 46, "Text"],
Cell[CellGroupData[{
Cell[62520, 1725, 874, 24, 47, "Input"],
Cell[63397, 1751, 1920, 50, 77, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[65354, 1806, 1248, 36, 112, "Input"],
Cell[66605, 1844, 1590, 42, 46, "Output"]
}, Open  ]],
Cell[68210, 1889, 2173, 55, 112, "Input"],
Cell[70386, 1946, 2200, 56, 112, "Input"],
Cell[CellGroupData[{
Cell[72611, 2006, 947, 25, 80, "Input"],
Cell[73561, 2033, 1721, 44, 77, "Output"],
Cell[75285, 2079, 1722, 44, 77, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[77068, 2130, 104, 1, 120, "Section"],
Cell[77175, 2133, 5520, 155, 240, "Input"],
Cell[82698, 2290, 5964, 161, 240, "Input"],
Cell[88665, 2453, 6074, 165, 240, "Input"],
Cell[94742, 2620, 6141, 166, 240, "Input"],
Cell[CellGroupData[{
Cell[100908, 2790, 575, 16, 47, "Input"],
Cell[101486, 2808, 683, 17, 46, "Output"]
}, Open  ]],
Cell[102184, 2828, 1282, 32, 47, "Input"],
Cell[CellGroupData[{
Cell[103491, 2864, 260, 5, 47, "Input"],
Cell[103754, 2871, 7902, 213, 227, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[111705, 3090, 121, 1, 120, "Section"],
Cell[111829, 3093, 118, 1, 46, "Text"],
Cell[111950, 3096, 564, 14, 80, "Input"],
Cell[112517, 3112, 99, 1, 46, "Text"],
Cell[112619, 3115, 6055, 146, 1328, "Input"],
Cell[118677, 3263, 319, 8, 47, "Input"],
Cell[118999, 3273, 101, 1, 46, "Text"],
Cell[119103, 3276, 5974, 144, 1328, "Input"],
Cell[125080, 3422, 411, 9, 47, "Input"],
Cell[125494, 3433, 100, 1, 46, "Text"],
Cell[125597, 3436, 2747, 70, 240, "Input"],
Cell[128347, 3508, 91, 1, 46, "Text"],
Cell[128441, 3511, 265, 7, 47, "Input"],
Cell[128709, 3520, 1041, 27, 80, "Input"],
Cell[129753, 3549, 1377, 41, 240, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
